(function(a){function e(a,b){return b=parseFloat(a.css(b)),isNaN(b)?0:b}function f(a){this.identifier=a}function h(a){this.constructor.call(this,a)}function j(a){this.constructor.call(this,a)}function l(a){this.constructor.call(this,a)}function n(a){this.constructor.call(this,a)}function p(){this.init=function(b,c){var d=this,c=a.extend({file_button:"Choose file",file_label:"No file chosen",responsive_select:!1,responsive_file:!1},c||{});return b=b.each(function(){return"SELECT"==this.nodeName&&this.size>0||this.$$custom_form_identifier?!0:(this.$$custom_form_identifier=d.new_element(this).init(c).identifier,void 0)})},this.execute=function(a,c){var e=c[0],f=Array.prototype.slice.call(c,1);return e in d?d[e].apply(a,f):a.each(function(){if(this.$$custom_form_identifier){var a=b[this.$$custom_form_identifier].instance;a[e].apply(a,f)}})},this.new_element=function(b,c){var d=a(b),e=f.build(d,c),g=e.get_id();return this.register_instance(g,e,d),e},this.register_instance=function(a,c,d){b[a]={element:d,instance:c,children:{}}},this.unregister_instance=function(a){var c=a.get_id();a=a.kill(),delete b[c]}}var b={fn:{}},d={disabled:function(a){if(void 0!=a||(a="all"),1==this.length)return b[this[0].$$custom_form_identifier].instance.disabled(a);var c="any"==a?!1:!0;return this.each(function(){var d=b[this.$$custom_form_identifier].instance.disabled(a);switch(a){case"all":if(c&&!d)return c=!1,!1;break;case"any":if(d)return c=!0,!1;break;case"none":if(!d)return c=!1,!1}}),c}};b._browser=a.browser||function(){var a,b,c;return c=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=c(navigator.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),b}(),f.total_instances=0,f.browser_string=function(){var a,c,d,e=b._browser;for(a in e)"version"==a?c=parseInt(e.version):d=a;return d+" "+d+c+(e.msie?"":" not_msie")}(),f.build=function(a){var b,c;if(b=a.is("select")?"select":"input_"+a.attr("type"),!(c=this.available_classes[b]))throw"No class available to build element of type "+b;return new c(b+"_"+f.total_instances++)},f.available_classes={},f.register_class=function(a,b){this.available_classes[a]=b};var g=f.prototype;a.extend(g,{is_disabled:!1,get_element:function(){return b[this.identifier].element},get:function(a){return b[this.identifier].children[a]},set:function(a,c){return b[this.identifier].children[c]=a,a},get_id:function(){return this.identifier},kill:function(){return this.identifier},active_replacement_class:function(a){this.replacement[a?"addClass":"removeClass"]("checked_"+this.element_type)},init:function(a){var c,b=this.get_element(),d=b.attr("id");return this.set_parameters(b,a),c=this.set_replacement(b),c.addClass(f.browser_string),d.match(/\S/)&&c.addClass("custom-form_"+d),this.replace_elements(b,c),this.init_replacement(b,c),this.disable_if_disabled(b),this.init_mouse_events(b,c),this},set_replacement:function(a){return this.set(this.get_replacement(a),"replacement")},init_mouse_events:function(a,b){var d,c=this.mouse_trigger();c.bind("mouseenter",this,this.hover_handler).bind("mouseleave",this,this.out_handler).bind("mouseup",this,this.mouse_up_handler).bind("mousedown",this,this.mouse_down_handler),d=b.parent("label"),0==d.length&&c.bind("click",this,this.click_handler),a.bind("focusin",this,this.focus_in).bind("focusout",this,this.focus_out).bind("change",this,this.change)},focus_in:function(a){a.data.focus(!0)},focus_out:function(a){a.data.focus(!1)},focus:function(a){this.is_disabled||this.get("replacement")[a?"addClass":"removeClass"]("focus_"+this.element_type)},change:function(){},label_handler:function(a){a.target==this&&(a.preventDefault(),a.data.get_element().triggerHandler("change"))},hover_handler:function(a){a.data.hover(!0)},out_handler:function(a){a.data.hover(!1)},mouse_up_handler:function(a){a.data.mouse_in(!1)},mouse_down_handler:function(a){a.data.mouse_in(!0)},hover:function(a){this.is_disabled||this.get("replacement")[a?"addClass":"removeClass"]("hover_"+this.element_type)},mouse_in:function(a){this.is_disabled||this.get("replacement")[a?"addClass":"removeClass"]("active_"+this.element_type)},disabled:function(a,b,c){var c,b=b||this.get_element();switch(a){case!0:case!1:return c=c||this.get("replacement"),b.attr("disabled",a),c[a?"addClass":"removeClass"]("disabled_"+this.element_type),this.is_disabled=a,a;case"none":return!b.is(":disabled");default:return b.is(":disabled")}},disable_if_disabled:function(a){this.is_disabled!=a.is(":disabled")&&this.disabled(!this.is_disabled,a)}}),h.IDENTIFIER="input_checkbox";var i=h.prototype=new f;i.constructor=f.prototype.constructor,a.extend(i,{element_type:"checkbox",uncheckeable:!1,set_parameters:function(a){this.element_id=a.attr("id"),this.element_name=a.attr("name")},get_replacement:function(){return a("<span class='"+this.element_type+"'></span>")},replace_elements:function(a,b){a.after(b),b.append(a)},init_replacement:function(a,b){var c,d;(c=a.is(":checked"))&&this.checked(!0,a,b),(d=a.is(":disabled"))&&this.disabled(!0,a,b),(c||d)&&this.update(a,b)},checked:function(a,b,c){b=b||this.get_element(),c=c||this.get("replacement"),a=void 0==a?!b.is(":checked"):a,(!this.uncheckeable||this.uncheckeable&&a)&&(b.prop("checked",a),b.trigger("change"))},mouse_trigger:function(){return this.get("replacement")},click_handler:function(a){if(!a.data.is_disabled){var b=a.data;b.get_element().focus().triggerHandler("click"),a.target==this&&b.checked()}},change:function(b){b.data.update(a(this))},update:function(a,b){var a=a||this.get_element(),c="checked_"+this.element_type,d=a.is(":checked"),b=b||this.get("replacement");this.disable_if_disabled(a),d&&!b.hasClass(c)?b.addClass(c):!d&&b.hasClass(c)&&b.removeClass(c)}}),f.register_class(h.IDENTIFIER,h),j.IDENTIFIER="input_radio";var k=j.prototype=new h;k.constructor=f.prototype.constructor,a.extend(k,{uncheckeable:!0,element_type:"radio",update:function(b,c){var b=b||this.get_element(),d="checked_"+this.element_type,e=b.is(":checked"),c=c||this.get("replacement");if(this.disable_if_disabled(b),e){var f=a("."+d).has("[name='"+this.element_name+"']").not(this.element_id);0!=f.length&&f.removeClass(d),c.addClass(d)}else c.removeClass(d)}}),f.register_class(j.IDENTIFIER,j),f.element_border_width=function(a){return parseInt(a.css("border-left-width"))-parseInt(a.css("border-right-width"))},l.IDENTIFIER="select";var m=l.prototype=new f;m.constructor=f.prototype.constructor,a.extend(m,{button_width:0,click_handler:a.noop,element_type:"select",redraw:function(){var b=this.get_element();b.removeAttr("style"),this.element_width=b.outerWidth();var c=this.get("replacement"),d=c.find(".select_content"),f=this.set(a(".select_label",c),"select_label"),g={width:this.element_width-e(c,"border-left-width")-e(c,"border-right-width")};b.css(g),c.css(g);var h=a(".select_button",c);f.css({width:g.width-h.outerWidth()-e(d,"border-left-width")-e(d,"border-right-width")-e(f,"border-right-width")-e(f,"border-left-width")})},set_parameters:function(a,b){this.responsive=b.responsive_select},get_replacement:function(b){var c=a("option:selected",b);return 0!=c.length||(c=a("option:first-child",b)),a("<span class='select'><span class='select_content' ><span class='select_button'><span class='select_button_icon'></span></span><span class='select_label'><span>"+c.text()+"</span></span></span></span>")},replace_elements:function(a,b){this.element_width=a.outerWidth(),a.after(b),b.append(a)},init_replacement:function(b,c){this.set(a(".select_label",c),"select_label"),this.responsive?c.addClass("responsive_select"):this.redraw(),b.bind("change",this,this.select_change)},init_mouse_events:function(a,c){f.prototype.init_mouse_events.call(this,a,c),(b._browser.mozilla||b._browser.msie)&&a.bind("keyup",this,this.key_up)},key_up:function(a){(38==a.which||40==a.which)&&a.data.update()},select_change:function(a){a.data.update_label()},update_label:function(){this.get("select_label").html("<span>"+a("option:selected",this.get_element()).text()+"</span>")},mouse_trigger:function(){return this.get_element()},update:function(){var a=this.get_element();this.disable_if_disabled(a),a.trigger("change")},select:function(b){var c=typeof b,d=this.get_element();switch(c){case"number":d.val(a(":nth-child("+b+")",d).val());break;case"function":b.apply(d);break;default:"string"==c||(b=b.to_s),d.find("option:contains('"+b+"')").prop("selected",!0)}this.update()}}),f.register_class(l.IDENTIFIER,l),n.IDENTIFIER="input_file";var o=n.prototype=new f;o.constructor=f.prototype.constructor,a.extend(o,{click_handler:a.noop,element_type:"file",set_parameters:function(a,b){this.label=b.file_label,this.button_label=b.file_button,this.responsive=b.responsive_file},get_replacement:function(){return a("<span class='file'><span class='file_content'><span class='file_button'><span></span>"+this.button_label+"</span><span class='file_label'><span>"+this.label+"</span></span></span></span>")},replace_elements:function(b,c){this.responsive||(this.element_width=b.outerWidth(),this.element_margin=b.css("margin-left"),this.element_padding=b.css("padding-left")),b.after(c);var d=a("<span class='file_wrap'></span>");c.append(d),d.append(b)},init_replacement:function(b,c){var d=d=this.set(a(".file_label",c),"file_label");if(b.bind("change",this,this.file_change),this.responsive)c.addClass("responsive_file");else{var e={width:this.element_width-parseInt(c.css("border-left-width"))-parseInt(c.css("border-right-width"))};b.css(e),c.css(e)}},mouse_trigger:function(){return this.get_element()},file_change:function(a){a.data.update_label()},update_label:function(){var a=this.get_element().val();a.match(/\S/)||(a=this.label),this.get("file_label").html("<span>"+a+"</span>")},update:function(){var a=this.get_element();this.disable_if_disabled(a),a.trigger("change")}}),f.register_class(n.IDENTIFIER,n),b.fn.ie6=function(){return b._browser.msie&&6>=parseInt(b._browser.version)},b.fn.ie6_instance=function(){return new function(){this.init=this.execute=function(a){return a}}},p.get_custom_form_instance=function(){return this.instance||(this.instance=b.fn.ie6()?b.fn.ie6_instance():new p),this.instance},a.fn.custom_form=function(a){var b=p.get_custom_form_instance();return"string"==typeof a&&a?b.execute(this,arguments):b.init(this,a)}})(jQuery);
